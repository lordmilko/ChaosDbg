<Project>
  <!-- Compile ChaosDbg.MSBuild (if it doesn't exist) and generate our custom view models -->
  <Target Name="GenerateChaosDbg" BeforeTargets="CoreCompile">
    <Exec Command="dotnet build $(ChaosDbgMSBuildProjectPath) -c $(Configuration)" Condition="!Exists($(ChaosDbgMSBuildOutputPath))" />
    
    <ItemGroup>
      <ViewModelFiles Condition="$(IsEngine)" Include="$(MSBuildProjectDirectory)\ViewModel\**\*.cs" />
      <ControlFiles Condition="$(IsUI)" Include="$(MSBuildProjectDirectory)\UI\**\*.cs" />
    </ItemGroup>

    <GenerateDependencyProperties Condition="$(IsUI)" Files="@(ControlFiles)" Output="$(GeneratedDependencyPropertiesPath)" />
    <GenerateViewModels Condition="$(IsEngine)" Files="@(ViewModelFiles)" Output="$(GeneratedViewModelsPath)" />

    <ItemGroup Condition="$(IsUI) AND Exists($(GenerateDependencyProperties))">
      <Compile Remove="$(GenerateDependencyProperties)" />
      <Compile Include="$(GenerateDependencyProperties)" Visible="false" />
    </ItemGroup>

    <ItemGroup Condition="$(IsEngine) AND Exists($(GeneratedViewModelsPath))">
      <Compile Remove="$(GeneratedViewModelsPath)" />
      <Compile Include="$(GeneratedViewModelsPath)" Visible="false" />
    </ItemGroup>
  </Target>
</Project>